\RequirePackage[utf8]{inputenc}
\RequirePackage[T1]{fontenc}
%\RequirePackage{latexsym,amssymb,amsmath,amsthm}
\RequirePackage{amssymb,amsmath,amsthm}
%\RequirePackage{marvosym}
\RequirePackage{xspace}
%\RequirePackage{calc}
\RequirePackage[final]{microtype}
\RequirePackage{xcolor}
%\RequirePackage[pdfborder={0 0 0}]{hyperref}
\RequirePackage{hyperref}
%\RequirePackage{breakurl}
\RequirePackage[symbol=${}^{\uparrow}$]{footnotebackref}
%\RequirePackage{xurl}
\RequirePackage[UKenglish,ngerman]{babel}
\selectlanguage{UKenglish}
\RequirePackage{graphicx}
%\RequirePackage{scrlayer-scrpage}
\RequirePackage{wrapfig}
%\RequirePackage{lastpage}
\RequirePackage{enumerate}
%\RequirePackage{blindtext}
%\RequirePackage{setspace}
%\onehalfspacing
\setlength{\marginparwidth}{2cm}
\RequirePackage[backgroundcolor=yellow!30!white,colorinlistoftodos]{todonotes}
\RequirePackage{pdfpages}
\RequirePackage[framemethod=default]{mdframed}
\RequirePackage[sort=standard,abbreviations,stylemods,style=index,nomain]{glossaries-extra}

% ============== Font: Noto ========================
%\RequirePackage[scaled=1.12]{nimbusmononarrow}
%\RequirePackage{inconsolata}
\RequirePackage[subscriptcorrection,mono]{notomath}
%\RequirePackage[mono,subscriptcorrection]{notomath}
%\RequirePackage[scaled=.88]{noto-mono}

%% ============== Font: BitStream Charter ========================
%\usepackage[scaled=.98,sups,osf]{XCharter}% osf in text, lining figures in math
%\usepackage[scaled=1.04,varqu,varl]{inconsolata}% inconsolata typewriter
%\usepackage[type1]{cabin}% sans serif
%\usepackage[uprightscript,charter,vvarbb,scaled=1.05]{newtxmath}
%\linespread{1.04}

% ===== Glossary style and abbreviations =====
\renewcommand{\glsnamefont}[1]{\mybold{#1}}
%\renewcommand\glstreepredesc{\quad}
\setabbreviationstyle{long-short}
\newabbreviation{DNB}{DNB}{German National Library \protect\autocite{DNBCatalogue}}
\newabbreviation{GND}{GND}{Integrated Authority File of the German National Library \protect\autocite{GND}}
\newabbreviation{HNA}{HNA}{historical network analysis}
\newabbreviation{ISNI}{ISNI}{International Standard Name Identifier \protect\autocite{ISNI}}
\newabbreviation{KPE}{KPE}{Kalliope Union Catalogue \protect\autocite{KPE}}
\newabbreviation{LCNAF}{LCNAF}{Library of Congress Name Authority File \protect\autocite{LCNAF}}
\newabbreviation{SNA}{SNA}{social network analysis}
\newabbreviation{SoNAR}{SoNAR}{research project \protect\enquote{SoNAR (IDH), Interfaces to Data for Historical Social Network Analysis and Research} \protect\autocite{Bludau2020,Menzel2020,SoNAR}}
\newabbreviation{VIAF}{VIAF}{Virtual International Authority File \protect\autocite{VIAF}}
\newabbreviation{ZDB}{ZDB}{German Union Catalogue of Serials \protect\autocite{ZDB}}

% ===== Set up TikZ (Macros see below) =====
\RequirePackage{pgfsys}
\RequirePackage{tikz}
\usetikzlibrary{automata,positioning,arrows.meta,graphs,decorations.text,calc,shapes,patterns}%,fit}


% ===== Set up biblatex and csquotes =====
%%%\RequirePackage[fixlanguage,noisbn,noissn]{babelbib}
%%%\selectbiblanguage{UKenglish}
%%%\setbtxfallbacklanguage{UKenglish}
%%%%\RequirePackage[noisbn,noissn]{babelbib}
\RequirePackage[style=american,german=quotes,english=american]{csquotes}
\RequirePackage[
  backend=biber,
  %style=ext-authoryear-icomp,  % didn't work with separate list of web resources (no semicolons between citation entries)
  style=ext-authoryear,
  labelnumber,
  defernumbers,
  backref=true,
  autolang=hyphen,
%  sorting=ynt,sortcites,
  opcittracker=true,
%  maxnames=3, minnames=1, nohashothers=false,
%  uniquename=full,
  isbn=false,
]{biblatex}
\addbibresource{bib/ma_jabref.bib}
\setlength{\bibitemsep}{4pt}


% \DefaultInheritance{override=true}

% --- enable Oxford comma before 'and' in author lists
\DefineBibliographyExtras{UKenglish}{\def\finalandcomma{\addcomma}}

% --- Citations in brackets rather than parens
\DeclareOuterCiteDelims{parencite}{\bibopenbracket}{\bibclosebracket}
\DeclareInnerCiteDelims{textcite}{\bibopenbracket}{\bibclosebracket}

% --- Declare redundant languages 
\DeclareRedundantLanguages{English}{english,american,british,canadian,australian,newzealand,USenglish,UKenglish}


%% --- Preparations for longer hyperlink anchors in citations
%%%%\renewcommand*{\multicitedelim}{\addsemicolon\space}
%
%\renewbibmacro*{cite}{%
%  \printtext[bibhyperref]{%
%    \iffieldundef{shorthand}
%    {\ifthenelse{\ifnameundef{labelname}\OR\iffieldundef{labelyear}}
%      {\usebibmacro{cite:label}%
%        \setunit{\printdelim{nonameyeardelim}}}
%      {\printnames{labelname}%
%        \setunit{\printdelim{nameyeardelim}}}%
%      \usebibmacro{cite:labeldate+extradate}}
%    {\usebibmacro{cite:shorthand}}}}
%
%\renewbibmacro*{citeyear}{%
%  \printtext[bibhyperref]{%
%    \iffieldundef{shorthand}
%    {\iffieldundef{labelyear}
%      {\usebibmacro{cite:label}}
%      {\usebibmacro{cite:labeldate+extradate}}}
%    {\usebibmacro{cite:shorthand}}}}
%
%\renewbibmacro*{textcite}{%
%  \ifnameundef{labelname}
%  {\iffieldundef{shorthand}
%    {\printtext[bibhyperref]{%
%        \usebibmacro{cite:label}}%
%      \setunit{%
%        \global\booltrue{cbx:parens}%
%        \printdelim{nonameyeardelim}\bibopenparen}%
%      \ifnumequal{\value{citecount}}{1}
%      {\usebibmacro{prenote}}
%      {}%
%      \printtext[bibhyperref]{\usebibmacro{cite:labeldate+extradate}}}
%    {\printtext[bibhyperref]{\usebibmacro{cite:shorthand}}}}
%  {\printtext[bibhyperref]{\printnames{labelname}}%
%    \setunit{%
%      \global\booltrue{cbx:parens}%
%      \printdelim{nameyeardelim}\bibopenparen}%
%    \ifnumequal{\value{citecount}}{1}
%    {\usebibmacro{prenote}}
%    {}%
%    \usebibmacro{citeyear}}}
%
%\renewbibmacro*{cite:shorthand}{%
%  \printfield{shorthand}}
%
%\renewbibmacro*{cite:label}{%
%  \iffieldundef{label}
%  {\printfield[citetitle]{labeltitle}}
%  {\printfield{label}}}
%
%\renewbibmacro*{cite:labeldate+extradate}{%
%  \printlabeldateextra}

% --- Preparations for two bibliographies
\letbibmacro{cite:default}{cite}

\newbibmacro{cite:online}{%
  \printtext[bibhyperref]{%
    \printfield{labelprefix}%
    \printfield{labelnumber}}}

\renewbibmacro{cite}{%
  \ifbibmacroundef{cite:\thefield{entrytype}}
  {\usebibmacro{cite:default}}
  {\usebibmacro*{cite:\thefield{entrytype}}}}

\DeclareFieldFormat{labelnumberwidth}{\mkbibbrackets{#1}}
\DeclareFieldFormat{shorthandwidth}{\mkbibbrackets{#1}}
\defbibenvironment{online}
  {\list
     {\printtext[labelnumberwidth]{%
        \printfield{labelprefix}%
        \printfield{labelnumber}}}
     {\setlength{\labelwidth}{\labelnumberwidth}%
      \setlength{\leftmargin}{\labelwidth}%
      \setlength{\labelsep}{\biblabelsep}%
      \addtolength{\leftmargin}{\labelsep}%
      \setlength{\itemsep}{\bibitemsep}%
      \setlength{\parsep}{\bibparsep}}%
      \renewcommand*{\makelabel}[1]{\hss##1}}
  {\endlist}
  {\item}

\DeclareRefcontext{online}{labelprefix=Web}

% --- Omit year from web resources
\AtEveryBibitem{%
  \ifentrytype{online}{%
    \clearfield{labelyear}%
  }{%
  }%
}

% --- Show short author names in front of author names, if specified
\renewbibmacro*{begentry}{%
    \ifnameundef{shortauthor}
        {}
        {\ifopcit{}{\printnames{shortauthor}%
         \addspace\textendash\space}}}
%        {\printnames{shortauthor}%
%         \addspace\textendash\space}}

% --- Print URL only if there is no DOI
\renewbibmacro*{doi+eprint+url}{%
    \printfield{doi}%
    \newunit\newblock%
%    \iftoggle{bbx:eprint}{%
%        \usebibmacro{eprint}%
%    }{}%
    \newunit\newblock%
    \iffieldundef{doi}{%
        \usebibmacro{url+urldate}}%
        {}%
    }

% ===== General settings =====
%\pagestyle{empty}
%\pagestyle{plain}
\pagestyle{headings}
%\pagestyle{scrheadings}
%\clearpairofpagestyles
%\setkomafont{pagenumber}{\textit}

\parskip6pt
\parindent0pt
\Urlmuskip=0mu plus 10mu

% ----- highlight overfull hboxes
%\overfullrule=5pt

%\DeclareFontSeriesDefault{bf}{sb}
\newcommand{\mybold}[1]{\textbf{\textsf{#1}}}

\counterwithout{footnote}{chapter}

\newcommand{\fns}{\footnotesize}

% ===== Colours =====

\definecolor{gray}{rgb}{.5,.5,.5}
\definecolor{dgray}{rgb}{.2,.2,.2}
%\definecolor{dgblu}{rgb}{.2,.2,.27}
%\definecolor{dgblu}{rgb}{.2,.2,.32}
%\definecolor{dgblu}{rgb}{.18,.18,.29}
\definecolor{dgblu}{rgb}{.1,.1,.5}

\definecolor{lightblue}{rgb}{0.929,0.953,0.996}
\definecolor{medblue}{rgb}{0.816,0.922,0.996}
\colorlet{ansvar}{yellow!50!white}
\colorlet{anovar}{orange!30!white}

%\colorlet{Econnred}{red!50}
%\colorlet{Econnblue}{blue!20}
%\colorlet{Econngreen}{green!10}
%\colorlet{Econniso}{black}
%
\colorlet{Econnred}{red!7}
\colorlet{Econnblue}{blue!25}
\colorlet{Econngreen}{green!50!black}
\colorlet{Econniso}{white}

\colorlet{ctableone}{white}
\colorlet{ctabletwo}{lightblue}
\colorlet{ctablehead}{medblue}


%\definecolor{solblue}{HTML}{268BD2}
\colorlet{linkblue}{dgblu}

% ===== hyperref setup =====

\hypersetup{
  pdfhighlight = /P,
  colorlinks=true,
  urlcolor=linkblue,
  filecolor=linkblue,
  linkcolor=linkblue,
  citecolor=linkblue,
  raiselinks=true,
  breaklinks,
  unicode,
}

%% ===== Appendix formatting =====
%\newcommand\useprefix[2]{#1#2}
%
%\NewDocumentCommand\appendixprefixintoc{}
%{%
%  \DeclareTOCStyleEntry
%    [%
%      entrynumberformat=\useprefix{\appendixname~},% add the prefix before the entrynumber
%      dynnumwidth
%    ]{default}{chapter}
%  \DeclareTOCStyleEntries[%
%    dynindent
%  ]{default}{chapter,subsection,subsubsection,paragraph,subparagraph}
%}
%
%\newcommand*{\appendixmore}{%
%  \renewcommand*{\chapterformat}{%
%%    \appendixname~\thechapter\autodot\enskip}%
%    \appendixname~\thechapter:\enskip}%
%  \renewcommand*{\chaptermarkformat}{%
%%    \appendixname~\thechapter\autodot\enskip}%
%    \appendixname~\thechapter:\enskip}%
%  \addtocontents{toc}{\appendixprefixintoc}%
%}

% ===== Macros for TikZ pictures =====
\newcommand{\tikztab}[2][l]{\begin{tabular}{@{}#1@{}}#2\end{tabular}}
\newcommand{\tikztabtwo}[3][l]{\begin{tabular}{@{}#1@{}}\mystrut#2\\[-1.6pt]\mystrut#3\\[-1.5pt]\end{tabular}}
\newcommand{\tikztabthree}[4][l]{\begin{tabular}{@{}#1@{}}\mystrut#2\\[-1.6pt]\mystrut#3\\[-1.6pt]\mystrut#4\\[-1.5pt]\end{tabular}}
\tikzstyle{ansvar}=[circle,fill=ansvar,inner sep=.5mm]
\tikzstyle{anovar}=[diamond,fill=anovar,inner sep=.5mm]

\newcommand{\tikzinlinenode}[2][]{%
  \begin{tikzpicture}[
    >=Latex,baseline=-2.8pt,
    every node/.style={on grid,rectangle,rounded corners=1mm,draw=black,fill=lightblue,thick,inner sep=1.5mm},
%    every edge/.style={draw=black,thick}
  ]
    \node[#1] () {\fns\mystrut#2};
  \end{tikzpicture}%  
}

\newcommand{\mystrut}{\rule[-2.2pt]{0pt}{9.8pt}}

% ===== Theorems etc. =====
\newtheoremstyle{myplain} % name
{\topsep}                    % Space above
{\topsep}                    % Space below
{\itshape}                   % Body font
{}                           % Indent amount
{\bfseries\sffamily}         % Theorem head font
{.}                          % Punctuation after theorem head
{.5em}                       % Space after theorem head
{}  % Theorem head spec (can be left empty, meaning ‘normal’)

\newtheoremstyle{mydefinition} % name
{\topsep}                    % Space above
{\topsep}                    % Space below
{\upshape}                   % Body font
{}                           % Indent amount
{\bfseries\sffamily}         % Theorem head font
{.}                          % Punctuation after theorem head
{.5em}                       % Space after theorem head
{}  % Theorem head spec (can be left empty, meaning ‘normal’)

\theoremstyle{mydefinition}
\newtheorem{definition}{Definition}
%\surroundwithmdframed[outerlinewidth=1pt,
%  innerlinewidth=0pt,
%  middlelinewidth=0pt,
%  middlelinecolor=white,
%  leftline=false,rightline=false]{definition}
\surroundwithmdframed[%
  linewidth=1pt,
  linecolor=black!50,
  innertopmargin=-3pt,innerleftmargin=0pt,innerrightmargin=0pt,
  leftline=false,rightline=false
]{definition}

\theoremstyle{myplain}


% ===== todonotes styles =====
\todostyle{think}{backgroundcolor=yellow!30!white}
\todostyle{quick}{backgroundcolor=orange!30!white}
\todostyle{ask}{backgroundcolor=blue!30!white}
\todostyle{defer}{backgroundcolor=black!30!white}


% ==============

\newcommand{\textsfbf}[1]{\textsf{\textbf{{\boldmath #1}}}}
\newcommand{\textsfbfgr}[1]{\textsf{\textbf{\textcolor{dgray}{#1}}}}
\newcommand{\textsfbfgb}[1]{\textsf{\textbf{\textcolor{dgblu}{#1}}}}

\newcommand{\parI}{\par\smallskip}
\newcommand{\parII}{\par\medskip}
\newcommand{\parIII}{\par\bigskip}

%\ifoot[]{Thomas Schneider, M27, Klausur 1, Teil ...}
%\ofoot*{\pagemark/\pageref{LastPage}}

\newcommand{\Lmc}{\ensuremath{\mathcal{L}}\xspace}
\newcommand{\Nmc}{\ensuremath{\mathcal{N}}\xspace}

\newcommand{\term}[1]{\textsf{#1}}
%\newcommand{\fnterm}[1]{\textsf{{\footnotesize #1}}}
\newcommand{\sig}[1]{\textsf{#1}}

\newcommand{\NC}{\ensuremath{\mathsf{N}_\mathsf{C}}\xspace}
\newcommand{\NI}{\ensuremath{\mathsf{N}_\mathsf{I}}\xspace}
\newcommand{\NO}{\ensuremath{\mathsf{N}_\mathsf{O}}\xspace}
\newcommand{\NR}{\ensuremath{\mathsf{N}_\mathsf{R}}\xspace}
\newcommand{\NV}{\ensuremath{\mathsf{N}_\mathsf{V}}\xspace}
\newcommand{\namespace}{\textup{\textsf{N}}\xspace}

\newcommand{\VARANS}{\ensuremath{\mathsf{VAR}_\mathsf{ANS}}\xspace}
\newcommand{\VARANON}{\ensuremath{\mathsf{VAR}_\mathsf{ANON}}\xspace}

%\newcommand{\exaquery}[1]{\textsf{\textbf{{\small\boldmath Q#1}}}}
\newcommand{\exaquery}[1]{\textsf{\textbf{{\boldmath Q#1}}}}
\newcommand{\subquestion}[1]{\textsf{\textbf{{\boldmath SQ#1}}}}
\newcommand{\hmph}[1]{\textsf{\textbf{{\boldmath H#1}}}}

