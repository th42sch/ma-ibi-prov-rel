% !TeX spellcheck = en_GB
% =================================================================
%\chapter{Automated Retrieval of Provenance Relationships}
\chapter{A Method for Retrieving Provenance Relationships}
\label{chap:retrieval}
\label{chap:method}

In the previous chapter, 
we have developed a model for answering provenance queries.
It is the vision of this thesis that, ultimately,
this model is implemented 
in a retrieval system
that answers provenance queries conforming to our model.
The primary user group for that system consists of provenance researchers
and historians who want to investigate, for example, the history of
items and collections or the social networks of historically important figures.

In this chapter, we design a method that serves
as a the general basis for a retrieval system.
This method abstracts away from specific details such as 
programming paradigms, languages, libraries, or data structures;
instead, it represents a high-level specification
for a detailed future implementation.

Our method will consist of a \emph{preparatory phase} that
needs to be carried out before users can interact with the system,
and a \emph{runtime phase} that consists of three subphases, which are
traversed consecutively and, ideally, in an iterative way.
We describe these phases in Section~\ref{sec:phases}.

We have already broached the distinction between a dynamic and a static setting
in the discussion of the insights from the \gls{SoNAR} project
in Section~\ref{subsec:insights_from_SoNAR}. 
We will take a closer look at these two settings in Section~\ref{sec:dynamic_vs_static}.
Finally, we will discuss several aspects of the system's interaction with its users
in Section~\ref{sec:user_interaction}.

% -------------------------------------------------------------------
\section{The Main Phases}
\label{sec:phases}

\newlength{\mainphases}\settowidth{\mainphases}{\fns \textbf{Preparatory Phase}~}%
\newlength{\subphases}\settowidth{\subphases}{\fns Answer Presentation~}%
%\begin{figure}[ht]
\begin{wrapfigure}[15]{o}{5.2cm}
  \centering
  \begin{tikzpicture}[
    >=Latex,
    every node/.style={on grid,rectangle,rounded corners=1mm,draw=black,fill=lightgreen,thick,inner sep=1.5mm},
    every edge/.style={draw=black,thick}
  ]
    
    % the 3 subphases of Runtime
    \begin{scope}[
      every node/.append style={text width=\subphases,align=center}
    ]
      \node                    (QF) {\fns\mystrut Query Formulation};
      \node [below=10mm of QF] (QP) {\fns\mystrut Query Processing};
      \node [below=10mm of QP] (AP) {\fns\mystrut Answer Presentation};
    \end{scope}

%    % separate node for 'Runtime Phase'
%    \node [above=10mm of QF,fill=none,draw=none] (rp) {\fns\mystrut\textbf{Runtime Phase}};
%
    % frames for the 2 main phases
    \begin{scope}[
      every node/.append style={text width=\mainphases,align=center,fill=none}
    ]      
      \node [fit={($(QF.north west) + (-0.3, 1.0)$) ($(AP.south east) + (0.7, -0.55)$)},inner sep=0mm] (RPF) {};
      \node [fit={($(QF.north west) + (-0.3, 1.5)$) ($(QF.north east) + (0.7, 2.1)$)},inner sep=0mm]  (PPF) {};
    \end{scope}
      
    % labels for the 2 main phases
    \begin{scope}[
      every node/.append style={draw=none,fill=none}
    ]      
      
      \node [right=0mm of PPF.west]                     (PP) {\fns\mystrut\textbf{Preparatory Phase}};
      \node [below right=0mm and 0mm of RPF.north west] (RP) {\fns\mystrut\textbf{Runtime Phase}};
    \end{scope}

    \begin{scope}[%
      every node/.style={draw=none,fill=none,inner sep=.2mm}
    ]
      
      \path[->]
        % the 3 main Group-1 relations
        (QF) edge (QP)
        (QP) edge (AP)
        (PPF) edge (RPF)
      ;
      
      \draw[->, rounded corners=2.8mm, draw=black, thick]
        (AP.south) |- ($(AP.south east) + (0.4, -0.3)$) -- ($(QF.north east) + (0.4, 0.45)$) -| (QF.north);
    \end{scope}
  \end{tikzpicture}
  
  \caption{Main phases of the retrieval method}
  \label{fig:method_phases}
\end{wrapfigure}
%\end{figure}

As already indicated, we distinguish between a \emph{preparatory phase}
and a \emph{runtime phase}.
The latter is divided into three subphases as shown in Figure~\ref{fig:method_phases}.
In the \emph{query formulation} phase, the system supports the user 
in constructing their query.
In the \emph{query processing} phase, the system evaluates the query
and computes answers.
In the \emph{answer presentation} phase, the system allows the user to
navigate through the computed answers.
Since the explorative approach was highlighted
in the context of the \gls{SoNAR} scenario (see Section~\ref{subsec:SoNAR_reports}),
it is very likely that the answers presented by the system will 
result in the user wanting to reformulate their original query.
In fact, query answers can be seen as one means of support
for formulating a query in the first place.
For this reason, we prefer to view the runtime phase as an iterative process,
which we indicate via the looping arrow in Figure~\ref{fig:method_phases}.





% -------------------------------------------------------------------
\section{Dynamic versus Static Setting}
\label{sec:dynamic_vs_static}

\dots

% -------------------------------------------------------------------
\section{User Interaction Aspects}
\label{sec:user_interaction}

\dots



\begin{itemize}
  \item
    data source $=$ union of all available data sources (see §\ref{subsec:data_sources})
  \item
    distinguish \emph{dynamic} and \emph{static} method -- continue discussion
    from Sections~\ref{subsec:insights_from_SoNAR} and~\ref{sec:computational_properties}
  \item
    for each of the two methods, develop/discuss:
    %
    \begin{itemize}
      \item
        preparatory steps
      \item
        QA algorithm (pseudocode?) and possibilities for implementation
      \item
        advantages (see below and Section~\ref{subsec:insights_from_SoNAR})
      \item
        disadvantages (dito)
      \item
        caveats
    \end{itemize}
    %
  \item
    dynamic vs.\ static method:
    %
    \begin{itemize}
      \item
        static: 
        
        data source graph is generated explicitly (using data integration techniques, e.g., LD)
        and updated in fixed intervals
                
        at runtime: provenance query is formulated as a \gls{SPARQL} query and posed against the graph
        
        learn from SoNAR insights
        
        reduction to SQL? use DB systems
      \item
        dynamic (preferred??):
        
        data source graph is implicit; data sources are queried \enquote{on the fly}
%        (this is the preferred scenario here; see delineation from SoNAR in §\ref{sec:HNA+SoNAR})
        
        data sources need to be defined and
        interactions with them programmed in advance
        
        at runtime: decompose query into single \gls{SPARQL} (sub)queries and pose them against several data sources,
        potentially iteratively;
        compose final answer from the partial answers
        $\leadsto$ demonstrate this for example query/ies!
      \item
        don't commit to dynamic method % (check mentions of \enquote{method}/\enquote{scenario}/\enquote{online}\enquote{off{}line} in text and rephrase if necessary)
      \item
        discuss pros and cons; connect to discussion in §\ref{sec:HNA+SoNAR}; reuse:
        
        More precisely, while our abstract model will centre around a single data source (graph)
        that represents the combination of the distributed repositories,
        our method will abstain from constructing that graph explicitly and, instead,
        answer queries \enquote{in place} over the original repositories.
        This way, our approach will not depend on hosting capacities,
        and it will always have direct access to the current content of the repositories.
        On the downside, our approach will depend on external web services provided by the repositories,
        and it will be sensitive to changes in their data models.
        Our dynamic approach also requires that inconsistencies are resolved
        a posteriori, i.e., every time a query answer is retrieved.
        As a final advantage, the dynamic approach is flexible
        in the sense that it can be applied to a static integrated data source as well,
        thus benefiting from the advantages of the static approach.
  \end{itemize}
    %
  \item
    get back to Section~\ref{sec:quality_of_answers}:
    %
    \begin{itemize}
      \item
        missing vs.\ spurious answers
      \item
        overapproximation
      \item
        \emph{reasoning}: ontologies and related technology -- also explain why
        missing knowledge cannot be added upfront, e.g., like this:
        
        Clearly, it would not be advisable to attempt adding all implicit knowledge to the data
        because that would massively inflate the data,
        as most terms have several superordinate concepts or relations and,
        furthermore, implicit knowledge is not restricted to taxonomic knowledge.
      \item
        \emph{hypothesising}
    \end{itemize}
    %
  \item
    get back to SoNAR discussion (Section~\ref{subsec:insights_from_SoNAR}) (?)
  \item
    get back to substitute information (from SoNAR and Section~\ref{sec:quality_of_answers})
    \todo[inline]{move discussion of substitute information from §\ref{subsec:further_information} to §\ref{chap:retrieval}?}
  \item
    indirect relationships
  \item
    ternary relations: quads instead of triples (in \gls{RDF} speak); add attributes to the graph model? (Markus Krötzsch's work?)
  \item
    \textbf{discuss interaction with the user!}
\end{itemize}
