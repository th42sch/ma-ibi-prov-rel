% !TeX spellcheck = en_GB

% =================================================================
\chapter{Modelling Provenance Relationships and Queries}

In this chapter, we develop a generic approach to modelling provenance relationships
that will serve as a basis for the investigations in the following chapters.
The central notion of this approach is that of a directed graph with node and edge labels,
which is a standard notion in computer science and discrete mathematics.
\todo{citation}

\section{Labelled Directed Graphs}

In a nutshell, a labelled directed graph consists of a set of nodes, a set of directed edges between
the nodes, a function that assigns unique names to the nodes,
and a function that labels the nodes (edges) with concepts (relations)
of which the nodes (edges) are instances.
In our setting, these four abstract components have the following meaning:
%
\begin{itemize}
  \item 
    Nodes represent entities such as works, expressions, manifestations, copies,
    persons, or corporations.
  \item 
    Edges represent relationships between nodes, which are typically directed:
    e.g., \term{has\_owner} points \emph{from} a book copy \emph{to} a person or corporation,
    whereas \term{is\_owner\_of} points into the opposite direction.
    Symmetric relationships, such as \term{is\_collaborator\_of},
    can be represented via two edges, one for each direction.
  \item 
    The unique node name specifies the individual that is represented by the node.
  \item 
    Node labels allow the specification of one or several concepts
    of which the respective node is an instance.
    For example, a node representing the physicist Albert Einstein
    may be labelled, among others, with the concepts \term{person}, \term{scientist},
    and \term{physicist}.
%  \item 

    Edge labels allow the specification of one or several relation names for each edge.
    For example, if a person $p$ is author \emph{and} owner of a book copy $b$,
    then this can be represented via an edge from $b$ to $p$ with the label
    $\{\term{has\_author},\term{has\_owner}\}$
    (and/or an edge from $b$ to $p$ with the label $\{\term{is\_author\_of},\term{is\_owner\_of}\}$).
\end{itemize}
%
A labelled directed graph can be visualised in the obvious way:
each node is represented using a circle or rectangle
enclosing the node's name,
and each edge is denoted by arrows, with the edge label written next to it,
see Figure~\ref{fig:example_graph}.

\begin{figure}
  \missingfigure{example graph}
  \caption{An example graph}
  \label{fig:example_graph}
\end{figure}

As we will see in the following, labelled directed graphs can be used in our setting
to represent (combinations of) data sources as well as queries.
They allow us to draw on standard notions from graph theory and query answering
in order to define admissible query answers and to devise methods for obtaining those.

The standard definition of a labelled directed graph is as follows.

%\begin{definition}
%  Let $R$ be a set of \emph{relation names}.
%  A \emph{directed edge-labelled graph over $R$} is a triple $G = (V,E,\Lmc)$,
%  where
%  %
%  \begin{itemize}
%    \item
%    $V$ is a set, whose members are called or \emph{nodes};\footnote{%
%      In classical graph theory, nodes are called \emph{vertices}; thus the set of
%      nodes of a graph is denoted by $V$. We adopt the denotation $V$ for conformity
%      and the more modern term ``node'' for brevity.%
%    }      
%    \item 
%    $E \subseteq V \times V$ is a set of pairs of nodes, whose members are called \emph{edges};
%    \item
%    $\Lmc : E \to 2^R$ is a function that assigns to each edge a non-empty set of relation names,
%    called the \emph{labels} of that edge; we call \Lmc a \emph{labelling function}.
%  \end{itemize}
%\end{definition}
%
\begin{definition}
  \label{def:ld_graph}
  Let \NV be a set of \emph{node names}, \NC set of \emph{concept names}, and \NR a set of \emph{relation names}.
  A \emph{directed labelled graph over $(\NV,\NC,\NR)$} is a triple $G = (V,E,\Nmc,\Lmc)$,
  where
  %
  \begin{itemize}
    \item
      $V$ is a set, whose members are called \emph{nodes};\footnote{%
        In classical graph theory, nodes are called \emph{vertices}; thus the set of
        nodes of a graph is denoted by $V$. We adopt the denotation $V$ for conformity
        and the more modern term ``node'' for brevity.%
      }      
    \item 
      $E \subseteq V \times V$ is a set of pairs of nodes, whose members are called \emph{edges};
    \item
      $\Nmc : V \to \NV$ is an injective function that assigns
      to each node its \emph{name};
    \item
      $\Lmc : V \cup E \to \NV \cup 2^{\NR}$ is a function that assigns 
      to each node a set of concept names (called the node's \emph{labels}) and
      to each edge a non-empty set of relation names (called the edge's \emph{labels});
      we call \Lmc a \emph{labelling function}.
  \end{itemize}
\end{definition}
%
Definition~1 stipulates that
%
\begin{itemize}
  \item
    every node has a unique name and no two node have the same name (the latter via injectivity);
  \item
    a node can have an arbitrary number of labels, including no label (in case the node belongs to no concept);
  \item
    an edge can have an arbitrary number of labels, but that number must not be zero --
    the effect of an edge having no labels can be achieved by simply omitting the edge.
\end{itemize}

In the example in Figure~\ref{fig:example_graph},
we have $V = \dots$, \dots\todo{finish example}

% ------------------------------------------------------------------
\section{Modelling Data Sources, Queries, and Answers}

We now model a data source (e.g., library catalogue, authority file, or other database)
using the exact notion of a graph that we have introduced above.
%
\begin{definition}
  A \emph{data source} is a labelled directed graph.
\end{definition}
%
With this definition, we obviously commit ourselves to a restricted view of a data source:
graphs can only represent unary and binary relations via nodes and edges
while, in general, a database may have relations of arbitrary arity.
However, we do not consider this a significant restriction in the context of our purpose
because we only want to represent relations that are relevant for provenance research,
and those are predominantly unary or binary. \todo{strengthen argument, give examples, consult literature}



In order to model queries, ...


*****

\todo[inline]{The following needs to be adapted to incorporate individuals and distinguish them from variables}

Since we want to use graphs to model data sources as well as queries,
we will additionally have to allow query variables as node names.
For this purpose, we fix a set $\VAR \subseteq \NV$ of \emph{variables},
which can be used as node names.

Answers to queries will be defined via homomorphisms that map graphs representing queries
to graphs representing data sources.
%
\begin{definition}
  Given two labelled directed graphs $G = (V,E,\Lmc)$ and $G' = (V',E',\Lmc')$,
  a \emph{homomorphism from $G'$ to $G$} is a map $h : V' \to V$ such that
  %
  \begin{enumerate}
    \item
      $\Lmc'(v') = \Lmc(h(v'))$ for every node $v' \in V'$ with $\Lmc'(v') \notin \VAR$;
      
      i.e., if a node in $G'$ is labelled with a name that is not a variable,
      then its image under $h$ has the same label in $G$.
    \item
      $\Lmc'(v_1', v_2') \subseteq \Lmc(h(v_1'), h(v_2'))$
      for every edge $(v_1',v_2') \in E$;
      
      i.e., all labels of an edge in $G'$ occur with its image under $h$ in $G$
      (but the image may have additional labels).
  \end{enumerate}
  %
  If $h$ is a homomorphism from $G'$ to $G$, we write $h : G' \to G$.
  If there is some homomorphism from $G'$ to $G$, we write $G' \lesssim G$.
\end{definition}

\begin{figure}
  \missingfigure{example homomorphism}
  \caption{An example homomorphism}
  \label{fig:example_hmph}
\end{figure}



% ------------------------------------------------------------------
\section{Attributes on Relationships}

\todo[inline]{TODO}

\begin{itemize}
  \item
    sketch idea: e.g., add year to relationship \term{has\_owner} -- example: ``passed on to'' requires descending year numbers \emph{and} no successor with intermediate year number
  \item
    explain difficulties: more complex formal machinery (def.\ of graphs, queries, and matches)
  \item
    argue for limited use: with or without the use of additional attributes, results may contain false positives due to incomplete data $\leadsto$ manual inspection is necessary anyway
  \item
    conclusion: attributes are not covered here
\end{itemize}



% ------------------------------------------------------------------
\section{OLD: Provenance Relationship Networks}

In order to define provenance relationship networks, we now fix sets $N$ and $R$ to consist
of elements that are relevant for provenance research:
The set $N$ consists of \emph{entities} such as 
works, expressions, manifestations, copies, people, and corporations
that are contained in a fixed collection of data sources (such as library catalogues,
authority files, and knowledge bases). The set $R$ consists of relationships
between entities that are taken either from the FRBR model\todo{cite, introduce}
or from the same collection of data sources (in particular, relationships between people and/or corporations
such as ``is student of'' or ``collaborated with'' or ...)

*** FIRST THINK ABOUT QUERY TYPES, THEN CONTINUE WITH THESE DEF.S ***


A \emph{provenance relationship network} is a directed edge-labelled graph over $(N,R)$,
where $N$ ... and $R$ ... \todo{continue}
